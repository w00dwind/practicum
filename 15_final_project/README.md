# Прогноз оттока клиентов сотового оператора

Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов.
Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. 

Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

Наша задача  - **Определить клиентов, которые потенциально могут покинуть оператора.**
Целевой признак - **end_date** - если дата указана, значит клиент покинул компанию. 

- Мы будем решать задачу классификации
- Метрика задачи - **ROC-AUC**

## Данные:
contract.csv
    Признаки:
        * customer_id - id клиента (признак, по которому можно объединять датасеты)
        * begin_date - Дата подписания контракта
        * type - тип оплаты: ежемесячный, годовой и тд
        * paperless_billing - безналичный расчет
        * payment_method - способ оплаты
        * monthly_charges - ежемесячные траты на услуги
        * total_charges - всего потрачено денег на услуги
internet.csv
    Признаки:
        * customerID
        * InternetService - Тип подключения (dsl / fiber optic)
        * OnlineSecurity - Услуга безопасного интернета
        * OnlineBackup - Услуга резервного копирования
        * DeviceProtection - Услуга защита устройства
        * TechSupport - Услуга тех. поддержки
        * StreamingTV - Услуга ТВ
        * StreamingMovies - Услуга кино
        
personal.csv
    Признаки:
        * customerID
        * gender - Пол
        * SeniorCitizen - наличие пенсионного статуса по возрасту
        * Partner - Наличие супруга(и)
        * Dependents - наличие иждивенцев
phone.csv
    Признаки:
        * customerID
        * MultipleLines - наличие возможности ведения параллельных линий во время звонка
        
## Ход исследования:
### Предобработка:

1. Загрузка датасета
2. Первичный анализ и предобработка
    1. Удаление скрытых пропусков и приведение колонок к нужному типу
    3. Добавление признака с количеством дней пребывания клиента в компании.
3. Распределение целевой переменной.
4. Гистограмма ежемесячных трат пользователей.
5. Статистический анализ ежемесячных трат. 
6. Корреляция числовых признаков с целевой переменной.
7. Распределение целевой переменной относительно категориальных признаков. 
8. Добавление признака с количеством используемых сервисов. 
9. Поиск выбросов в числовых признаках. 
10. Влияние количества дней в компании на отток. 

### Обучение моделей:

1. Baseline - алгоритм, с которым мы будем сравнивать последующие. Оценка качества алгоритма по кросс валидации
2. Бустинги - Catboost, XGBoost, LightGBM - проверка моделей по кросс валидации, подбор гиперпараметров, оценка наилучшей модели на тестовой выборке. 
3. Для каждой модели построение графика  feature importances. Для оценки наиболее важных принзнаков для алгоритма. 
4. Вывод на основе эксперементов, сравнение качества используемых алгоритмов на графике. 
5. Рекомендации для заказчика, оценка модели не только по наивысшему ROC-AUC, но и оптимизация метрики recall.

## Выводы:

**Разведовательный анализ и предобработка**
- Даже без использования моделей машинного обучения мы обнаружили довольно много важных зависимостей в части разведовательного анализа. Большинство уходящих клиентов среди:
- Клиентов с ежемесячной оплатой
- Безналичной формой оплаты
- Способом оплаты "электронный чек"
- Пользователей, подключенных по оптоволокну
- Пользователей, у которых отсутствует сервисы "online security", "device_protection", "streaming tv", "streaming_movies"
- Гендер не влияет на отток
- Пользователи без пары (не состоящие в браке) и без детей чаще покидают провайдера. 
- Пользователей, которые недавно пользуются услугами оператора

- Из признаков мы удалили - customer_id, т.к. уникальный идентификатор пользователя не пригодится для нашей задачи и begin_year, begin_month, begin_day, т.к. эти данные могут быть потенциальной утечкой таргета в обучающую выборку. 
- Новый признак - количество сервисов, который оказался весьма важным для CatBoost. 

**Построение и выбор наилучшей модели.**
- Среди алгоритмов машинного обучения наилучший результат целевой метрики по итогам кросс-валидаци показал CatBoost . Результат ROC-AUC на тренировочной выборке - **0.932**, на тестовой выборке - **0.928**. Разница в скорах говорит о небольшом переобучении, но не критичном для результата, модель можно назвать достаточно устойчивой. 
- Параметры лучшей модели: 
'grow_policy': 'Lossguide'
 'iterations': 900
 'l2_leaf_reg': 5
 'max_depth': 9
 'random_strength': 3
 .
grow_policy - определяет как именно будет достигнута максимальная глубина. Lossguide означает, что дерево будет строиться лист за листом, пока не достигнет максимальной глубины. Параметр iterations отвеает за количество деревьев. Слишком большое количество деревьев неизбежно приведет к переобучению, в нашей задачи оптимальное найденное значение - 900. Наилучший коэффицент L2 регуляризации - 5, максимальная глубина дерева 9. random_strength - степень рандомизации при делении дерева, помогает предотвратить переобучение.
- Количество сервисов оказалось сильной фичей для алгоритма CatBoost, но не для других бустингов.
- Метрика recall - более важна для нашей задачи, т.к. мы не хотим пропустить ни одного потенциального "беглеца". Recall всех моделей схож, прирост ROC-AUC у CatBoost происходит засчет более высокого precision. Для нашей задачи важнее recall, однако precision поможет компании сохранить ресурсы, потраченный на промокоды и другие способы повышения лояльности клиентов. 
- Если оптимизировать метрику recall, стоит согласовать стоимость повышения лояльности клиентов с отделом маркетинга, т.к. ложно положительные срабатывания будут потенциальным убытком для компании. Если стоимость удержания клиента высока, возможно стоит оптимизировать метрику precision.
- Также можно предложить построить модель оценки вероятности оттока клиента и ранжировать предложения промокодов с разной величиной скидки, в зависимости от вероятности оттока. Тогда можно снизить потенциальные затраты компании на повышение лояльности. 
